document.addEventListener("DOMContentLoaded",(function(){const e=io("",{query:{role:"presentation-control",id:(()=>{const e=document.cookie.split(";");for(let t of e){const[e,n]=t.trim().split("=");if("sessionID"===e)return decodeURIComponent(n)}return null})()}});let t=null,n=null,i=null,s=null;const o=e=>{console.log("%cset game now","background-color: black; color: green; font-weight: bold;"),t=e,n=t.presentation.slideData.slideList,i=t.presentation},l=e=>{const t=`o${e?"n":"ff"}line`,n=$("#status");n.html(t),n.removeClass("online offline"),n.addClass(t)},d=e=>{Object.assign(i,e),t.presentation=i},a=e=>{d(e),f(),r(),u()},r=()=>{const i=n.slice().filter((e=>!e.exclude));$(".slide_link").each(((e,n)=>{const s=i[e];if(s.isEnabled=!0,s.hasOwnProperty("action")&&(s.action.toLowerCase().includes("assignteams")&&t.teams.length>0&&(s.isEnabled=!1),s.action.includes("startRound"))){const e=window.justNumber(s.action),n=window.justNumber(t.round);s.gameRound={round:t.round,number:n},s.isNextRound=e===n+1&&(t.round.toString().includes("*")||0===n),s.rCompleteNotThisNext=t.round.toString().includes("*")&&e!==n+1,s.isNextRound||e===n||(s.isEnabled=!1),s.rCompleteNotThisNext&&(s.isEnabled=!1),s.teamsAssiged=t.teams.length>0,0===t.teams.length&&(s.isEnabled=!1),s.title=`${s.title.includes("(R")?"":"(R"+e+") "}${s.title}`}s.title=`${"video"!==s.type||s.title.includes("-symbols-")?"":'<span class="slideicon material-symbols-outlined">movie</span>'}${s.title}`,s.isCurrent=e===t.presentation.currentSlide})),window.renderTemplate("slidelist","facilitator.slidelist",i,(()=>{const n=$(".slide_link");n.off("click").on("click",(function(){const e=!$(this).attr("class").includes("disabled"),t=parseInt($(this).closest(".slide_info").attr("id").split("_")[2]);e&&c(t)}));let i=null;n.off("mouseover").on("mouseover",(function(){const e=$(this).closest(".slide_info").find(".slidenote");Boolean(e.html())&&(i=setTimeout((()=>{e.fadeIn()}),500))})),n.off("mouseout").on("mouseout",(function(){const e=$(this).closest(".slide_info").find(".slidenote");Boolean(e.html())&&(clearTimeout(i),e.fadeOut())})),$(".replay").off("click").on("click",(function(){parseInt($(this).closest(".slide_info").attr("id").split("_")[2]);const n={gameID:t.uniqueID,event:"reload"};e.emit("presentationEvent",n,(e=>{a(e)}))}))}))},c=async n=>{const i={gameID:t.uniqueID,event:"gotoSlide",val:n};e.emit("presentationEvent",i,(e=>{a(e)}))},u=()=>{const e=i.autoplay;$("#sb_auto").removeClass(`auto_${!e}`).addClass(`auto_${e}`)},f=()=>{const e={currentSlide:t.presentation.currentSlide};window.facilitatorSlideChange(e),window.renderTemplate("slide_detail_previous","facilitator.slideshow.detail",{title:"previous",info:n[e.currentSlide-1],valid:e.currentSlide>0}),window.renderTemplate("slide_detail_current","facilitator.slideshow.detail",{title:"current",info:n[e.currentSlide],valid:!0}),window.renderTemplate("slide_detail_next","facilitator.slideshow.detail",{title:"next",info:n[e.currentSlide+1],valid:e.currentSlide<n.length-1}),$("#sb_previous").attr({disabled:!i.hasPrevious}),$("#sb_next").attr({disabled:!i.hasNext})},m=n=>{if(n){const i={gameID:t.uniqueID,event:n};e.emit("presentationEvent",i,(e=>{a(e)}))}else console.warn("pEvent requires an event name (string)")},p=()=>{let i=s.find(".buttons").find("button");const o=t.slide>0?n[t.slide-1]:{isEnabled:!1},d=t.slide===n.length-1?{isEnabled:!1}:n[t.slide+1],a={previous:!o.isEnabled,next:!d.isEnabled};i=i.add($(".slideshow_control")),i.each(((e,t)=>{let n=$(t),i=n.attr("id").replace("sb_","");Boolean(a[i])?n.addClass("disabled"):(n.off("click").on("click",(function(){m(i)})),n.removeClass("disabled"))})),e.emit("checkSocket",{sock:"pres",address:t.address},(e=>{l(Boolean(e.total))}))},g=e=>{n?c(0):setTimeout((()=>{g(e)}),300)};e.on("presentationSlideUpdated",(e=>{})),e.on("videoPositionUpdate",(e=>{$(`#slide_info_${e.slideID}`).find(".progress").css({width:`${e.perc}%`})})),e.on("presentationConnect",(e=>{l(e.connected)})),e.on("gameUpdate",(e=>{(e=>{const n=JSON.parse(JSON.stringify(t));if(n){const i=n.teams,s=e._updateSource.event.split(" ").reverse()[0],o=["startRound","endRound","presentationAction"].some((e=>s.includes(e)));t=e,o&&setTimeout((()=>{const s=t.teams.length!==i.length,o=justNumber(t.round)!==justNumber(n.round),l=e.round.toString().includes("*");(s||o||l)&&r(),p()}),300)}})(e)})),e.on("preparePresentation",(e=>{g(e)})),window.slideContolsInit=e=>{o(e),s=$("#slideshow_controls"),d({hasPrevious:i.currentSlide>0,hasNext:i.currentSlide<n.length-1}),f(),r(),p(),u()},window.pEvent=m,window.findRoundTrigger=e=>{const t=i.slideData.slideList.filter((t=>t.trigger&&t.trigger.includes(`scoreRound:${e}`)));if(t.length>1)console.warn("multiple slides contain same trigger action.");else if(t.length){const e=t[0].ref;e!==i.currentSlide&&c(e)}},window.updateSlideList=r,window.showSlides=()=>{n?console.log(n):console.log("no slides to show")}}));
