document.addEventListener("DOMContentLoaded",(function(){const e=window.location.hash.replace("#","").replace(/\?.*$/,""),t=sessionStorage.getItem("clientId")||crypto.randomUUID();sessionStorage.setItem("clientId",t);const n=io("",{query:{role:"fakegen",type:"fakeGenerator",id:e,clientId:t}}),o=$("#num"),s=1,l=40;let a,i,r,c,d=null,f=null;parseInt(window.getQueries().start||0);const g=()=>{sessionStorage.setItem(w(),JSON.stringify(a))},p=()=>{const t=a.filter((e=>e.s===c)),n=t[0];if(t.length){const t=`pf${50*r+n.n}`,o=`${e}?fake=true&fid=${t}`;n.o=!0,n.s=1,n.p=t,g(),window.open(o,"_blank"),setTimeout(p,300+400*Math.random())}else $("#fakeForm").find("button").attr("disabled",!1)},m=()=>a.length,u=()=>{console.log("game updated"),(()=>{const e=m()+50*r;if(!isNaN(e)&&null!==d&&null!==f){const t=1e3+(e+1),o=`${window.isLocal()?f.localDevAddress:window.location.origin}${d.address}?fake=true&fid=pf${t}`;$("#qroverlay").html(""),n.emit("getQrString",o.replace("=pf","=pfm"),(e=>{const t=`${o}${e}`;$("#qroverlay").html(t)}))}})()},w=()=>`fakegen-${e}-${r}-fakes`,h=()=>{a.length?a.forEach((e=>console.log(window.clone(e)))):console.log("no fakes exist")},k=t=>{r=t.fakegenID,a=sessionStorage.getItem(w())||[],a="string"==typeof a?JSON.parse(a):a;const o=document.title.replace(/^\(\d+\)\s*/,"");document.title=`(${r}) ${o}`;const s=$("H1").html().replace(/^\(\d+\)\s*/,"");$("H1").html(`(${r}) ${s}`),$("H1").css({"font-size":"2rem"});const l=$("#num");l.val(sessionStorage.getItem(`${w}-inp`)||1),l.on("change",(()=>{const e=window.justNumber(l.val());sessionStorage.setItem(`${w}-inp`,e)})),n.emit("getGame",e,(e=>{d=e,d&&window.getSession(d.uniqueID,(e=>{f=e,u()}))}))};n.on("checkOnConnection",(e=>{k(e)})),n.on("gameUpdate",(e=>{d=e,u()})),n.on("playerRemoved",(e=>{const t=a.filter((t=>t.p===e.player))[0];t.o=!1,t.s=2,g()})),n.on("sessionReset",(e=>{sessionStorage.clear(),window.location.reload()})),window.launchFakes=e=>{e.preventDefault(),$("#fakeForm").find("button").attr("disabled",!0),i=parseFloat($("#num").val());const t=a.length?a[a.length-1].n:0;for(let e=0;e<i;e++)a.push({n:e+t+1,o:!1,s:0});c=0,p()},window.reopenFakes=e=>{e.preventDefault();const t=a.filter((e=>2===e.s));if(t.length>0){confirm(`This will reopen ${t.length} fake player${t.length>1?"s":""}, are you sure you want to do this?`)&&(c=2,p())}else alert("no closed fakes")},window.clearFakes=e=>{e.preventDefault();const t=a.filter((e=>2===e.s));if(t.length>0){const e=t.length;confirm(`will remove ${e} fake player${e>1?"s":""}`)&&(a=a.filter((e=>2!==e.s)),h(),g())}else alert("no closed fakes")},window.checkInputType=()=>{o.val()<s&&o.val(s),o.val()>l&&o.val(l)}}));
