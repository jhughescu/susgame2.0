document.addEventListener("DOMContentLoaded",(function(){const e=window.location.hash.replace("#",""),t=io("",{query:{role:"updatelog",id:e}});$("#logs");let o=$("#logDetail"),n=null,a=null,s=null;const l=e=>{const t={};for(var o in Object.entries(e).forEach((([e,o])=>{o.game===n&&(t[e]=o)})),t){const e=t[o],n=e.event.split(" "),a=e.timestamp.split("-")[1];e.eventSrc=n[0],e.eventName=n[1],e.timestampDisplay=`${a.substr(0,2)}:${a.substr(2,2)}:${a.substr(4,2)}`,e.id=`${o}`,e.player=e.pid?e.pid:e.playerID,delete e.event;const s=Object.keys(e).sort(),l={};s.forEach((t=>{l[t]=e[t]}))}return a=t,t},i=()=>{const e=$(".showLogDetail");o=$("#logDetail"),e.on("mouseover",(function(){const e=$(this);clearTimeout(s),s=setTimeout((()=>{window.renderTemplate("logDetail","object.table",a[e.attr("id")]),o.fadeIn()}),200)})),e.on("mouseout",(function(){o=$("#logDetail"),o.hide(),clearTimeout(s)})),$("html, body").animate({scrollTop:$(document).height()},1e3)},c=e=>{const t={logs:l(JSON.parse(e))},o=Boolean(Object.keys(t.logs).length);o||(t.message=null===n?"game must be specified as URL hash, e.g. ..updatelog#game-6tsu":`no logs found for game "${n}"`),window.renderTemplate("logs",o?"update.log.display":"error",t,i)},d=()=>{t.emit("getUpdateLog",(e=>{c(e)}))},r=()=>{Boolean(window.location.hash)&&(n=window.location.hash.replace("#","/"))};$(document).on("mousemove",(function(e){const t=e.pageY-o.height()-30,n=t>0?t:0;o.css({top:`${n}px`,left:`${e.pageX+20}px`})})),window.addEventListener("hashchange",(function(){r(),d()}),!1),t.on("logsUpdated",(e=>{c(e)})),r(),d()}));
